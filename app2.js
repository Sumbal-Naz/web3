const Tx = require('ethereumjs-tx').Transaction
const Web3 = require('web3')
const web3 = new Web3('https://ropsten.infura.io/v3/c3d1b312a1df491b9d486e2b4b2dc82e'); // Ropsten node

const account1 = '0xE04aef7e8e689eda053843583E8cf6210378Bf6d';
const privateKey1 = Buffer.from(process.env.PRIVATE_KEY_1, 'hex')

web3.eth.getTransactionCount(account1, (err, txCount) => {
    // smart contract data
    const data = '0x60806040523480156200001157600080fd5b506040518060400160405280600681526020017f53546f6b656e0000000000000000000000000000000000000000000000000000815250600490805190602001906200005f92919062000249565b506040518060400160405280600281526020017f535400000000000000000000000000000000000000000000000000000000000081525060059080519060200190620000ad92919062000249565b50670de0b6b3a76400006007819055506012600660006101000a81548160ff021916908360ff16021790555033600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550600660009054906101000a900460ff1660ff16600a6200013b919062000382565b620f42406200014b9190620004bf565b600281905550600254600080600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163073ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef6002546040516200023b91906200030a565b60405180910390a3620005cb565b82805462000257906200052a565b90600052602060002090601f0160209004810192826200027b5760008555620002c7565b82601f106200029657805160ff1916838001178555620002c7565b82800160010185558215620002c7579182015b82811115620002c6578251825591602001919060010190620002a9565b5b509050620002d69190620002da565b5090565b5b80821115620002f5576000816000905550600101620002db565b5090565b620003048162000520565b82525050565b6000602082019050620003216000830184620002f9565b92915050565b6000808291508390505b6001851115620003795780860481111562000351576200035062000560565b5b6001851615620003615780820291505b80810290506200037185620005be565b945062000331565b94509492505050565b60006200038f8262000520565b91506200039c8362000520565b9250620003cb7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8484620003d3565b905092915050565b600082620003e55760019050620004b8565b81620003f55760009050620004b8565b81600181146200040e576002811462000419576200044f565b6001915050620004b8565b60ff8411156200042e576200042d62000560565b5b8360020a91508482111562000448576200044762000560565b5b50620004b8565b5060208310610133831016604e8410600b8410161715620004895782820a90508381111562000483576200048262000560565b5b620004b8565b62000498848484600162000327565b92509050818404811115620004b257620004b162000560565b5b81810290505b9392505050565b6000620004cc8262000520565b9150620004d98362000520565b9250817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff048311821515161562000515576200051462000560565b5b828202905092915050565b6000819050919050565b600060028204905060018216806200054357607f821691505b602082108114156200055a57620005596200058f565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60008160011c9050919050565b6114f280620005db6000396000f3fe608060405234801561001057600080fd5b50600436106100ea5760003560e01c806391b7f5ed1161008c578063a035b1fe11610066578063a035b1fe1461024f578063a9059cbb1461026d578063dd62ed3e1461029d578063f0141d84146102cd576100ea565b806391b7f5ed146101f757806395d89b411461021357806398d5fdca14610231576100ea565b806323b872dd116100c857806323b872dd1461015b578063313ce5671461018b57806370a08231146101a95780638da5cb5b146101d9576100ea565b806306fdde03146100ef578063095ea7b31461010d57806318160ddd1461013d575b600080fd5b6100f76102eb565b60405161010491906111a7565b60405180910390f35b61012760048036038101906101229190610e7f565b610379565b604051610134919061118c565b60405180910390f35b610145610550565b6040516101529190611289565b60405180910390f35b61017560048036038101906101709190610e30565b61055a565b604051610182919061118c565b60405180910390f35b6101936108af565b6040516101a091906112a4565b60405180910390f35b6101c360048036038101906101be9190610dcb565b6108c2565b6040516101d09190611289565b60405180910390f35b6101e161090a565b6040516101ee9190611171565b60405180910390f35b610211600480360381019061020c9190610ebb565b610930565b005b61021b61093a565b60405161022891906111a7565b60405180910390f35b6102396109c8565b6040516102469190611289565b60405180910390f35b6102576109d2565b6040516102649190611289565b60405180910390f35b61028760048036038101906102829190610e7f565b6109d8565b604051610294919061118c565b60405180910390f35b6102b760048036038101906102b29190610df4565b610cd4565b6040516102c49190611289565b60405180910390f35b6102d5610d5b565b6040516102e29190611289565b60405180910390f35b600480546102f8906113ed565b80601f0160208091040260200160405190810160405280929190818152602001828054610324906113ed565b80156103715780601f1061034657610100808354040283529160200191610371565b820191906000526020600020905b81548152906001019060200180831161035457829003601f168201915b505050505081565b600080339050600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1614156103ef576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016103e690611229565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff16141561045f576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161045690611209565b60405180910390fd5b82600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9258560405161053d9190611289565b60405180910390a3600191505092915050565b6000600254905090565b6000803390506000600160008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050838111610623576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161061a906111c9565b60405180910390fd5b838161062f9190611331565b9050610682846000808973ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610d7590919063ffffffff16565b6000808873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550610715846000808873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610d8b90919063ffffffff16565b6000808773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508473ffffffffffffffffffffffffffffffffffffffff168673ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef866040516107b49190611289565b60405180910390a380600160008873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff168673ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9258660405161089a9190611289565b60405180910390a36001925050509392505050565b600660009054906101000a900460ff1681565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b8060078190555050565b60058054610947906113ed565b80601f0160208091040260200160405190810160405280929190818152602001828054610973906113ed565b80156109c05780601f10610995576101008083540402835291602001916109c0565b820191906000526020600020905b8154815290600101906020018083116109a357829003601f168201915b505050505081565b6000600754905090565b60075481565b600080339050600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161415610a4e576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610a4590611249565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff161415610abe576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610ab5906111e9565b60405180910390fd5b826000808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205411610b3e576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610b3590611269565b60405180910390fd5b610b8f836000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610d7590919063ffffffff16565b6000808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550610c22836000808773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610d8b90919063ffffffff16565b6000808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef85604051610cc19190611289565b60405180910390a3600191505092915050565b6000600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b6000600660009054906101000a900460ff1660ff16905090565b60008183610d839190611331565b905092915050565b60008183610d9991906112db565b905092915050565b600081359050610db08161148e565b92915050565b600081359050610dc5816114a5565b92915050565b600060208284031215610ddd57600080fd5b6000610deb84828501610da1565b91505092915050565b60008060408385031215610e0757600080fd5b6000610e1585828601610da1565b9250506020610e2685828601610da1565b9150509250929050565b600080600060608486031215610e4557600080fd5b6000610e5386828701610da1565b9350506020610e6486828701610da1565b9250506040610e7586828701610db6565b9150509250925092565b60008060408385031215610e9257600080fd5b6000610ea085828601610da1565b9250506020610eb185828601610db6565b9150509250929050565b600060208284031215610ecd57600080fd5b6000610edb84828501610db6565b91505092915050565b610eed81611365565b82525050565b610efc81611377565b82525050565b6000610f0d826112bf565b610f1781856112ca565b9350610f278185602086016113ba565b610f308161147d565b840191505092915050565b6000610f486025836112ca565b91507f53543a207472616e7366657220616d6f756e74206578636565647320616c6c6f60008301527f77616e63650000000000000000000000000000000000000000000000000000006020830152604082019050919050565b6000610fae6020836112ca565b91507f53543a207472616e7366657220746f20746865207a65726f20616464726573736000830152602082019050919050565b6000610fee601f836112ca565b91507f53543a20617070726f766520746f20746865207a65726f2061646472657373006000830152602082019050919050565b600061102e6021836112ca565b91507f53543a20617070726f76652066726f6d20746865207a65726f2061646472657360008301527f73000000000000000000000000000000000000000000000000000000000000006020830152604082019050919050565b60006110946022836112ca565b91507f53543a207472616e736665722066726f6d20746865207a65726f20616464726560008301527f73730000000000000000000000000000000000000000000000000000000000006020830152604082019050919050565b60006110fa6023836112ca565b91507f53543a207472616e7366657220616d6f756e7420657863656564732062616c6160008301527f6e636500000000000000000000000000000000000000000000000000000000006020830152604082019050919050565b61115c816113a3565b82525050565b61116b816113ad565b82525050565b60006020820190506111866000830184610ee4565b92915050565b60006020820190506111a16000830184610ef3565b92915050565b600060208201905081810360008301526111c18184610f02565b905092915050565b600060208201905081810360008301526111e281610f3b565b9050919050565b6000602082019050818103600083015261120281610fa1565b9050919050565b6000602082019050818103600083015261122281610fe1565b9050919050565b6000602082019050818103600083015261124281611021565b9050919050565b6000602082019050818103600083015261126281611087565b9050919050565b60006020820190508181036000830152611282816110ed565b9050919050565b600060208201905061129e6000830184611153565b92915050565b60006020820190506112b96000830184611162565b92915050565b600081519050919050565b600082825260208201905092915050565b60006112e6826113a3565b91506112f1836113a3565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff038211156113265761132561141f565b5b828201905092915050565b600061133c826113a3565b9150611347836113a3565b92508282101561135a5761135961141f565b5b828203905092915050565b600061137082611383565b9050919050565b60008115159050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b600060ff82169050919050565b60005b838110156113d85780820151818401526020810190506113bd565b838111156113e7576000848401525b50505050565b6000600282049050600182168061140557607f821691505b602082108114156114195761141861144e565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000601f19601f8301169050919050565b61149781611365565b81146114a257600080fd5b50565b6114ae816113a3565b81146114b957600080fd5b5056fea2646970667358221220668fb9aaf3f5d64f1abc7741dad83792c4997471535e289a5ab027ae5ac52f8464736f6c63430008000033'
    
    //Build the transaction
    const txObject = {
        nonce:    web3.utils.toHex(txCount),
        gasLimit: web3.utils.toHex(1000000), // Raise the gas limit to a much higher amount
        gasPrice: web3.utils.toHex(web3.utils.toWei('10', 'gwei')),
        data: data
    }
    console.log(txObject)
    
    //sign transaction
    const tx = new Tx(txObject)
    tx.sign(privateKey1)

    const serializedTransaction = tx.serialize()
    const raw = '0x' + serializedTransaction.toString('hex')
    
    // Broadcast the transaction
    web3.eth.sendSignedTransaction(raw, (err, txHash) => {
        console.log('err:', err, 'txHash: ', txHash )
    })

})